name: Generate Org Stats

on:
  # –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–∞–∑ –≤ –¥–µ–Ω—å –≤ –ø–æ–ª–Ω–æ—á—å
  schedule:
    - cron: '0 0 * * *'
  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã Actions
  workflow_dispatch:

jobs:
  build-org-stats:
    runs-on: ubuntu-latest
    steps:
      # –≠—Ç–æ—Ç Action —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–ª—è –Ω–∞—Å –∫—Ä–∞—Å–∏–≤—ã–π SVG —Ñ–∞–π–ª —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
      - uses: lowlighter/metrics@latest
        with:
          # –ò–º—è —Ñ–∞–π–ª–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω
          filename: org-stats.svg

          # –¢–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API GitHub
          token: ${{ secrets.GITHUB_TOKEN }}
          
          # –£–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω—É–∂–Ω–∞ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –∞ –Ω–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          user: DiametrEDU
          
          # –£–∫–∞–∑—ã–≤–∞–µ–º, –∫–∞–∫–∏–µ –ø–ª–∞–≥–∏–Ω—ã (–±–ª–æ–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏) –º—ã —Ö–æ—Ç–∏–º –≤–∏–¥–µ—Ç—å
          # –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ, –Ω–∞–º –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –ø–ª–∞–≥–∏–Ω —Å —è–∑—ã–∫–∞–º–∏
          base: "" # –û—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –±–ª–æ–∫–∏
          plugins: |
            languages
            
          # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø–ª–∞–≥–∏–Ω–∞ —è–∑—ã–∫–æ–≤
          plugin_languages: yes
          plugin_languages_analysis_timeout: 15
          plugin_languages_categories: markup, programming # –ö–∞–∫–∏–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤ —Å—á–∏—Ç–∞—Ç—å
          plugin_languages_colors: github # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ü–≤–µ—Ç–∞ GitHub –¥–ª—è —è–∑—ã–∫–æ–≤
          plugin_languages_limit: 8 # –ü–æ–∫–∞–∑–∞—Ç—å 8 —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —è–∑—ã–∫–æ–≤
          plugin_languages_threshold: 0% # –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —è–∑—ã–∫–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –∏—Ö –ø—Ä–æ—Ü–µ–Ω—Ç –º–∞–ª
          plugin_languages_layout: compact # –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥

      # –≠—Ç–æ—Ç —à–∞–≥ –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
      - name: –ö–æ–º–º–∏—Ç –∏ –ø—É—à SVG
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          # –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª –≤ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ
          git add org-stats.svg
          # –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ñ–∞–π–ª –∏–∑–º–µ–Ω–∏–ª—Å—è
          if ! git diff --staged --quiet; then
            git commit -m "üìä –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —è–∑—ã–∫–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏"
            git push
          else
            echo "–ò–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –Ω–µ—Ç, –∫–æ–º–º–∏—Ç –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è."
          fi
